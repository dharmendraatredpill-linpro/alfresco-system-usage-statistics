if(typeof RL=="undefined"||!RL){var RL={}}(function(){var c=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML;var b=YAHOO.Bubbling;RL.SummaryStatisticsConsole=function(d){this.name="RL.SummaryStatisticsConsole";RL.SummaryStatisticsConsole.superclass.constructor.call(this,d);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datasource","datatable","paginator","json","history"],this.onComponentsLoaded,this);var f=this;this.data={selectionData:new Object(),internalData:new Object(),externalData:new Object()};this.loadingMessage=null;this.fnShowLoadingMessage=function(){f.loadingMessage=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+a(f.msg("message.loading"))+"</span>",noEscape:true})};this.timerShowLoadingMessage=null;ListPanelHandler=function g(){ListPanelHandler.superclass.constructor.call(this,"main")};this.LoadAvailableYears=function(){var h=c.get(this.id+"-statistics-control-year");h.onchange=this.OnChangeYearFilter;this.timerShowLoadingMessage=YAHOO.lang.later(2000,this,this.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/treenode/node/alfresco/company/home/Data%20Dictionary/Redpill-Linpro/Statistics/SummaryStatistics",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:this.LoadAvailableYears_success,scope:this},failureCallback:{fn:this.LoadAvailableYears_failure,scope:this}})};this.LoadAvailableYears_success=function(j){if(this.timerShowLoadingMessage){this.timerShowLoadingMessage.cancel()}if(this.loadingMessage){try{this.loadingMessage.destroy()}catch(n){}}if(j!=null&&j.json!=null){var h=j.json.items;var o=c.get(this.id+"-statistics-control-year");for(var k=0;k<h.length;k++){var m=h[k];var l=document.createElement("option");l.value=m.name;l.innerHTML=m.name;o.appendChild(l)}}};this.LoadAvailableYears_failure=function(h){if(this.timerShowLoadingMessage){this.timerShowLoadingMessage.cancel()}if(this.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};this.OnChangeYearFilter=function(h){var i=h.currentTarget.options[h.currentTarget.selectedIndex];var j=i.value;f.timerShowLoadingMessage=YAHOO.lang.later(2000,this,f.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/slingshot/doclib2/doclist/all/node/alfresco/company/home/Data%20Dictionary/Redpill-Linpro/Statistics/SummaryStatistics/"+j+"?sortField=cm%3acreated&sortAsc=false",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:f.OnChangeYearFilter_success,scope:f},failureCallback:{fn:f.OnChangeYearFilter_failure,scope:f}})};this.OnChangeYearFilter_success=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(j){}}if(h!=null&&h.json!=null){f.data.selectionData=h.json;var i=function(m,l,n){f.widgets.dataTableSelection.onDataReturnInitializeTable.call(f.widgets.dataTableSelection,m,l,n)};var k={success:i,failure:i,scope:this.widgets.dataTableSelection,argument:this.widgets.dataTableSelection.getState()};this.widgets.dataSourceSelection.sendRequest("",k)}};this.OnChangeYearFilter_failure=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};this.SelectStatisticsRow=function(h){var j=this.getRecord(h.target).getData().node.nodeRef;var i=j.replace("://","/");f.timerShowLoadingMessage=YAHOO.lang.later(2000,f,f.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/node/"+i+"/content",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:f.SelectStatisticsRow_success,scope:f},failureCallback:{fn:f.SelectStatisticsRow_failure,scope:f}})};this.SelectStatisticsRow_success=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}if(h!=null&&h.json!=null){var j=c.get(f.id+"-statistics-summary");j.classList.remove("hidden");j.innerHTML="<span class='summary-header'>"+f._msg("label.numberOfActiveUsers")+":</span> <span class='summary-value'>"+h.json.numberOfActiveUsers+"</span><br />";j.innerHTML+="<span class='summary-header'>"+f._msg("label.numberOfUsers")+":</span> <span class='summary-value'>"+h.json.numberOfUsers+"</span><br />";j.innerHTML+="<span class='summary-header'>"+f._msg("label.numberOfSites")+":</span> <span class='summary-value'>"+h.json.numberOfSites+"</span><br />";j.innerHTML+="<span class='summary-header'>"+f._msg("label.numberOfDocuments")+":</span> <span class='summary-value'>"+h.json.numberOfDocuments+"</span><br />"}};this.SelectStatisticsRow_failure=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};YAHOO.extend(ListPanelHandler,Alfresco.ConsolePanelHandler,{onLoad:function e(){f.widgets.dataSourceSelection=new YAHOO.util.FunctionDataSource(function(){return YAHOO.lang.JSON.stringify(f.data.selectionData)},{responseType:YAHOO.util.FunctionDataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{recordOffset:"startIndex",totalRecords:"totalRecords"}}});this._setupDataSelectionTable();f.LoadAvailableYears()},_setupDataSelectionTable:function(){var h=function(j,k,l,m){j.innerHTML=a(k.getData().node.properties["cm:created"].value)};var i=[{key:"node.properties.cm:created",label:f._msg("select-statistics.label"),sortable:false,formatter:h}];f.widgets.dataTableSelection=new YAHOO.widget.DataTable(f.id+"-statistics-select-list",i,f.widgets.dataSourceSelection,{MSG_EMPTY:f._msg("message.emptystatistics"),MSG_ERROR:f._msg("message.emptystatistics"),selectionMode:"single"});f.widgets.dataTableSelection.subscribe("rowMouseoverEvent",f.widgets.dataTableSelection.onEventHighlightRow);f.widgets.dataTableSelection.subscribe("rowMouseoutEvent",f.widgets.dataTableSelection.onEventUnhighlightRow);f.widgets.dataTableSelection.subscribe("rowClickEvent",f.widgets.dataTableSelection.onEventSelectRow);f.widgets.dataTableSelection.subscribe("rowClickEvent",f.SelectStatisticsRow)}});new ListPanelHandler();return this};YAHOO.extend(RL.SummaryStatisticsConsole,Alfresco.ConsoleTool,{onReady:function(){var d=this;RL.SummaryStatisticsConsole.superclass.onReady.call(this)},onRefreshClick:function(){this.LoadUserActivity()},_msg:function(d){return Alfresco.util.message.call(this,d,"RL.SummaryStatisticsConsole",Array.prototype.slice.call(arguments).slice(1))},_setDefaultDataTableErrors:function(d){var e=Alfresco.util.message;d.set("MSG_EMPTY",e("message.empty","RL.SummaryStatisticsConsole"));d.set("MSG_ERROR",e("message.error","RL.SummaryStatisticsConsole"))}})})();