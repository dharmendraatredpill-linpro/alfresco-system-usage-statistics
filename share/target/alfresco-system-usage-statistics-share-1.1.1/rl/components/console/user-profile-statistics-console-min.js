if(typeof RL=="undefined"||!RL){var RL={}}(function(){var c=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML;var b=YAHOO.Bubbling;RL.UserProfileStatisticsConsole=function(d){this.name="RL.UserProfileStatisticsConsole";RL.UserProfileStatisticsConsole.superclass.constructor.call(this,d);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datasource","datatable","paginator","json","history"],this.onComponentsLoaded,this);var f=this;this.data={selectionData:new Object(),userProfileData:new Object(),summaryData:new Object()};this.loadingMessage=null;this.fnShowLoadingMessage=function(){f.loadingMessage=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+a(f.msg("message.loading"))+"</span>",noEscape:true})};this.timerShowLoadingMessage=null;ListPanelHandler=function g(){ListPanelHandler.superclass.constructor.call(this,"main")};this.LoadAvailableYears=function(){var h=c.get(this.id+"-statistics-control-year");h.onchange=this.OnChangeYearFilter;this.timerShowLoadingMessage=YAHOO.lang.later(2000,this,this.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/treenode/node/alfresco/company/home/Data%20Dictionary/Redpill-Linpro/Statistics/UserProfileStatistics/json",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:this.LoadAvailableYears_success,scope:this},failureCallback:{fn:this.LoadAvailableYears_failure,scope:this}})};this.LoadAvailableYears_success=function(j){if(this.timerShowLoadingMessage){this.timerShowLoadingMessage.cancel()}if(this.loadingMessage){try{this.loadingMessage.destroy()}catch(n){}}if(j!=null&&j.json!=null){var h=j.json.items;var o=c.get(this.id+"-statistics-control-year");for(var k=0;k<h.length;k++){var m=h[k];var l=document.createElement("option");l.value=m.name;l.innerHTML=m.name;o.appendChild(l)}}};this.LoadAvailableYears_failure=function(h){if(this.timerShowLoadingMessage){this.timerShowLoadingMessage.cancel()}if(this.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};this.OnChangeYearFilter=function(h){var i=h.currentTarget.options[h.currentTarget.selectedIndex];var j=i.value;f.timerShowLoadingMessage=YAHOO.lang.later(2000,this,f.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/slingshot/doclib2/doclist/all/node/alfresco/company/home/Data%20Dictionary/Redpill-Linpro/Statistics/UserProfileStatistics/json/"+j+"?sortField=cm%3acreated&sortAsc=false",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:f.OnChangeYearFilter_success,scope:f},failureCallback:{fn:f.OnChangeYearFilter_failure,scope:f}})};this.OnChangeYearFilter_success=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(j){}}if(h!=null&&h.json!=null){f.data.selectionData=h.json;var i=function(m,l,n){f.widgets.dataTableSelection.onDataReturnInitializeTable.call(f.widgets.dataTableSelection,m,l,n)};var k={success:i,failure:i,scope:this.widgets.dataTableSelection,argument:this.widgets.dataTableSelection.getState()};this.widgets.dataSourceSelection.sendRequest("",k)}};this.OnChangeYearFilter_failure=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};this.SelectStatisticsRow=function(h){var j=this.getRecord(h.target).getData().node.nodeRef;var i=j.replace("://","/");f.timerShowLoadingMessage=YAHOO.lang.later(2000,f,f.fnShowLoadingMessage);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/node/"+i+"/content",responseContentType:Alfresco.util.Ajax.JSON,method:Alfresco.util.Ajax.GET,successCallback:{fn:f.SelectStatisticsRow_success,scope:f},failureCallback:{fn:f.SelectStatisticsRow_failure,scope:f}})};this.SelectStatisticsRow_success=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}if(h!=null){this.data.summaryData.Summary=h.json.Summary;this.data.summaryData.startIndex=0;this.data.summaryData.totalRecords=h.json.Summary.length;var k=function(m,l,n){f.widgets.dataTableSummary.onDataReturnInitializeTable.call(f.widgets.dataTableSummary,m,l,n)};var j={success:k,failure:k,scope:this.widgets.dataTableSummary,argument:this.widgets.dataTableSummary.getState()};this.widgets.dataSourceSummary.sendRequest("",j)}};this.SelectStatisticsRow_failure=function(h){if(f.timerShowLoadingMessage){f.timerShowLoadingMessage.cancel()}if(f.loadingMessage){try{this.loadingMessage.destroy()}catch(i){}}};YAHOO.extend(ListPanelHandler,Alfresco.ConsolePanelHandler,{onLoad:function e(){f.widgets.dataSourceSelection=new YAHOO.util.FunctionDataSource(function(){return YAHOO.lang.JSON.stringify(f.data.selectionData)},{responseType:YAHOO.util.FunctionDataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{recordOffset:"startIndex",totalRecords:"totalRecords"}}});f.widgets.dataSourceSummary=new YAHOO.util.FunctionDataSource(function(){return YAHOO.lang.JSON.stringify(f.data.summaryData)},{responseType:YAHOO.util.FunctionDataSource.TYPE_JSON,responseSchema:{resultsList:"Summary",metaFields:{recordOffset:"startIndex",totalRecords:"totalRecords"}}});this._setupDataSelectionTable();this._setupDataStatsTables();f.LoadAvailableYears()},_setupDataSelectionTable:function(){var h=function(k,l,m,n){k.innerHTML=a(l.getData().node.properties["cm:created"].value)};var j=function(r,o,l,n){var k=o.getData().location.file;var s=o.getData().location.path;var p=s.substring(s.length-4);var q=k.replace("json","csv");var m="<a class='userprofiledownloadstats' title='Download CSV' href='https://teamroom.scania.com/alfresco/s/com/scania/alfresco/teamroom/repo/getCSVcontentStats.csv?content="+q+"|"+p+"'>csv link</a>";r.innerHTML+=m};var i=[{key:"node.properties.cm:created",label:f._msg("select-statistics.label"),sortable:false,formatter:h},{key:"node.properties.cm:created",label:f._msg("select-download.label"),sortable:false,formatter:j}];f.widgets.dataTableSelection=new YAHOO.widget.DataTable(f.id+"-statistics-select-list",i,f.widgets.dataSourceSelection,{MSG_EMPTY:f._msg("message.emptystatistics"),MSG_ERROR:f._msg("message.emptystatistics"),selectionMode:"single"});f.widgets.dataTableSelection.subscribe("rowMouseoverEvent",f.widgets.dataTableSelection.onEventHighlightRow);f.widgets.dataTableSelection.subscribe("rowMouseoutEvent",f.widgets.dataTableSelection.onEventUnhighlightRow);f.widgets.dataTableSelection.subscribe("rowClickEvent",f.widgets.dataTableSelection.onEventSelectRow);f.widgets.dataTableSelection.subscribe("rowClickEvent",f.SelectStatisticsRow)},_setupDataStatsTables:function(){var z=function(G,H,I,J){G.innerHTML=a(J)};var i=function(G,H,I,J){G.innerHTML=a(J)};var A=function(G,H,I,J){G.innerHTML=a(J)};var C=function(G,H,I,J){G.innerHTML=a(J)};var B=function(G,H,I,J){G.innerHTML=a(J)};var s=function(G,H,I,J){G.innerHTML=a(J)};var n=function(G,H,I,J){G.innerHTML=a(J)};var v=function(G,H,I,J){G.innerHTML=a(J)};var E=function(G,H,I,J){G.innerHTML=a(J)};var r=function(G,H,I,J){G.innerHTML=a(J)};var p=function(G,H,I,J){G.innerHTML=a(J)};var w=function(G,H,I,J){G.innerHTML=a(J)};var o=function(G,H,I,J){G.innerHTML=a(J[0])};var u=function(G,H,I,J){G.innerHTML=a(J[1])};var l=function(G,H,I,J){G.innerHTML=a(J[2])};var F=function(G,H,I,J){G.innerHTML=a(J[3])};var D=function(G,H,I,J){G.innerHTML=a(J[4])};var y=function(G,H,I,J){G.innerHTML=a(J[5])};var t=function(G,H,I,J){G.innerHTML=a(J[6])};var m=function(G,H,I,J){G.innerHTML=a(J[7])};var h=function(G,H,I,J){G.innerHTML=a(J[8])};var k=function(G,H,I,J){G.innerHTML=a(J[9])};var q=function(G,H,I,J){G.innerHTML=a(J[10])};var x=function(G,H,I,J){G.innerHTML=a(J[11])};var j=[{key:"summary",label:f._msg("label.numUsers"),sortable:true,formatter:o,width:90},{key:"summary",label:f._msg("label.numUpdated"),sortable:true,formatter:u},{key:"summary",label:f._msg("label.numPictures"),sortable:true,formatter:l},{key:"summary",label:f._msg("label.numNickName"),sortable:true,formatter:F},{key:"summary",label:f._msg("label.numJobTitle"),sortable:true,formatter:D},{key:"summary",label:f._msg("label.numOfficePhone"),sortable:true,formatter:y},{key:"summary",label:f._msg("label.numMobilePhone"),sortable:true,formatter:t},{key:"summary",label:f._msg("label.numGeoLocation"),sortable:true,formatter:m},{key:"summary",label:f._msg("label.numCompany"),sortable:true,formatter:h},{key:"summary",label:f._msg("label.numAbout"),sortable:true,formatter:k},{key:"summary",label:f._msg("label.numLocalIntranet"),sortable:true,formatter:q},{key:"summary",label:f._msg("label.numSkills"),sortable:true,formatter:x}];f.widgets.dataTableSummary=new YAHOO.widget.DataTable(f.id+"-statistics-UPsummary-list",j,f.widgets.dataSourceSummary,{MSG_EMPTY:f._msg("message.empty"),MSG_ERROR:f._msg("message.empty")})}});new ListPanelHandler();return this};YAHOO.extend(RL.UserProfileStatisticsConsole,Alfresco.ConsoleTool,{onReady:function(){var d=this;RL.UserProfileStatisticsConsole.superclass.onReady.call(this)},onRefreshClick:function(){this.LoadUserActivity()},_msg:function(d){return Alfresco.util.message.call(this,d,"RL.UserProfileStatisticsConsole",Array.prototype.slice.call(arguments).slice(1))},_setDefaultDataTableErrors:function(d){var e=Alfresco.util.message;d.set("MSG_EMPTY",e("message.empty","RL.UserProfileStatisticsConsole"));d.set("MSG_ERROR",e("message.error","RL.UserProfileStatisticsConsole"))}})})();